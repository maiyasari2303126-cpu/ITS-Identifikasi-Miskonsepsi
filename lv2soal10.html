<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kuis Super HOTS SMP ‚Äì Fungsi, Relasi, dan Luas Jelas</title>

  <!-- Chart.js & Tailwind -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body { font-family: 'Inter', sans-serif; }
    .chart-container { width: 100%; height: 100%; }
  </style>
</head>
<body class="bg-fuchsia-50 min-h-screen flex items-center justify-center p-4">

<div class="max-w-4xl w-full bg-white rounded-3xl shadow-2xl overflow-hidden">

  <!-- HEADER -->
  <div class="p-6 md:p-8 bg-gradient-to-r from-pink-500 via-purple-500 to-indigo-500 text-white flex items-center justify-between">
    <div>
      <h1 class="text-3xl md:text-4xl font-black mb-1">
        Tantangan Titik Potong Segitiga Eksklusif
      </h1>
      <p class="text-lg font-light">
        Analisis Tiga Fungsi, Dua Titik Bulat, dan Luas Pecahan
      </p>
    </div>
    <div class="text-5xl">üü£üü™</div>
  </div>

  <div class="p-6 md:p-10 flex flex-col gap-8"><!-- SELALU ATAS‚ÄìBAWAH -->

    <!-- GRAFIK -->
    <div class="flex flex-col items-center">
      <h2 class="text-xl font-bold text-gray-700 mb-4 text-center border-b pb-2 w-full">
        Visualisasi Titik Kunci (Titik P1 dan P2 Bersih)
      </h2>
      <div class="w-full h-64 md:h-80 flex items-center justify-center bg-gray-50 rounded-xl p-4 shadow-inner chart-container">
        <canvas id="lineChartSuperHots"></canvas>
      </div>
      <p class="mt-2 text-sm text-purple-600 font-semibold text-center">
        Titik potong P1 dan P2 berada di koordinat bilangan bulat yang jelas.
      </p>
    </div>

    <!-- SOAL -->
    <div>
      <div class="question-box p-6 bg-pink-100 border-2 border-pink-500 rounded-xl shadow-lg">
        <p class="text-2xl font-extrabold text-purple-700 mb-4">
          Nomor 10
        </p>
        
        <p class="text-lg text-gray-800 mb-6 font-medium">
          Tiga garis saling berpotongan:
          <ol class="list-decimal list-inside ml-4 space-y-2 mt-4">
            <li>L1 (Magenta): y = 2x</li>
            <li>L2 (Hijau): y = x + 4</li>
            <li>L3 (Sian): y = 10 - x</li>
          </ol>
          <br>
          Hitung nilai:
          <br>
          <b>(9 √ó Luas Segitiga P) + (Jumlah Fungsi)</b>
        </p>

        <div class="space-y-4 text-gray-800">
          <label class="flex items-center p-3 rounded-lg bg-white shadow cursor-pointer hover:bg-pink-200 transition">
            <input type="radio" name="jawaban" value="A" class="h-5 w-5 mr-4"> A. 3
          </label>
          <label class="flex items-center p-3 rounded-lg bg-white shadow cursor-pointer hover:bg-pink-200 transition">
            <input type="radio" name="jawaban" value="B" class="h-5 w-5 mr-4"> B. 5
          </label>
          <label class="flex items-center p-3 rounded-lg bg-white shadow cursor-pointer hover:bg-pink-200 transition">
            <input type="radio" name="jawaban" value="C" class="h-5 w-5 mr-4"> C. 6
          </label>
          <label class="flex items-center p-3 rounded-lg bg-white shadow cursor-pointer hover:bg-pink-200 transition">
            <input type="radio" name="jawaban" value="D" class="h-5 w-5 mr-4"> D. 8
          </label>
        </div>
        
        <button onclick="cekJawaban()" class="mt-8 w-full px-8 py-3 bg-purple-600 text-white font-bold rounded-xl shadow-md hover:bg-purple-700 transition">
           SUBMIT
        </button>

        <div id="feedback" class="mt-6 p-4 rounded-xl text-md font-semibold border hidden"></div>

        <!-- Tombol Next -->
        <div id="nextBox" class="mt-6 hidden">
          <button onclick="keHasilLevel2()"
                  class="w-full px-6 py-3 rounded-xl bg-indigo-600 text-white font-bold shadow hover:bg-indigo-700">
             Lihat Hasil Level 2
          </button>
        </div>

      </div>
    </div>
  </div>
</div>

<script>
/* ====== GRAFIK ====== */
window.onload = function () {
  const points = (line) => {
    const data = [];
    for (let x = 2; x <= 5; x += 0.2) {
      let y;
      if (line === 1) y = 2 * x;
      if (line === 2) y = x + 4;
      if (line === 3) y = 10 - x;
      data.push({ x, y });
    }
    return data;
  };

  const ctx = document.getElementById("lineChartSuperHots").getContext("2d");

  new Chart(ctx, {
    type: "line",
    data: {
      datasets: [
        { label: "L1: y = 2x", data: points(1), borderColor: "#EC4899", borderWidth: 3, pointRadius: 0 },
        { label: "L2: y = x + 4", data: points(2), borderColor: "#10B981", borderWidth: 3, pointRadius: 0 },
        { label: "L3: y = 10 - x", data: points(3), borderColor: "#06B6D4", borderWidth: 3, pointRadius: 0 },
        {
          label: "Titik Potong",
          data: [
            { x: 4, y: 8 },
            { x: 3, y: 7 },
            { x: 10 / 3, y: 20 / 3 },
          ],
          borderColor: "#7C3AED",
          backgroundColor: "#7C3AED",
          pointRadius: 7,
          showLine: false,
        },
      ],
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        y: { min: 6, max: 9, title: { display: true, text: "Sumbu Y" } },
        x: { min: 2, max: 5, type: "linear", title: { display: true, text: "Sumbu X" } },
      },
    },
  });
};

/* ====== KONFIGURASI KUNCI & MISKONSEPSI ====== */
const kunciJawaban = "C";

const miskonsepsiMap = {
  "A": "Kamu hanya menggunakan luas segitiga (1/3) lalu langsung menjadikan hasilnya jawaban akhir, tanpa menambahkan jumlah fungsi (3).",
  "B": "Kamu sudah menghitung 9 √ó (1/3) = 3, tetapi hanya menambahkan 2 fungsi, bukan 3, sehingga hasilnya 5.",
  "D": "Kamu keliru menghitung luas segitiga (bukan 1/3), sehingga hasil akhir (9 √ó luas) menjadi lebih besar dari seharusnya."
};

/* ====== REKAP LEVEL 2 DI LOCALSTORAGE ====== */
function simpanJawabanLevel2({ soalId, benar, jawaban, kunci }) {
  const KEY = "rekap_level2";

  let rekap =  sessionStorage.getItem(KEY);
  if (!rekap) {
    rekap = {
      totalBenar: 0,
      totalSalah: 0,
      daftar: []
    };
  } else {
    rekap = JSON.parse(rekap);
  }

  const waktu = new Date().toLocaleString();
  rekap.daftar.push({ soalId, benar, jawaban, kunci, waktu });

  if (benar) rekap.totalBenar++;
  else rekap.totalSalah++;

   sessionStorage.setItem(KEY, JSON.stringify(rekap));
}

/* ====== BAYESIAN NETWORK GLOBAL (M1‚ÄìM9) ====== */
function initBN() {
  let BN = JSON.parse( sessionStorage.getItem("BN_Data"));

  if (!BN) {
    BN = {
      prior: {
        M1: 0.4,
        M2: 0.4,
        M3: 0.4,
        M4: 0.4,
        M5: 0.4,
        M6: 0.4,
        M7: 0.4,
        M8: 0.4,
        M9: 0.4
      },
      likelihood: {
        M1: { benar: 0.3, salah: 0.7 },
        M2: { benar: 0.3, salah: 0.7 },
        M3: { benar: 0.3, salah: 0.7 },
        M4: { benar: 0.3, salah: 0.7 },
        M5: { benar: 0.3, salah: 0.7 },
        M6: { benar: 0.3, salah: 0.7 },
        M7: { benar: 0.3, salah: 0.7 },
        M8: { benar: 0.3, salah: 0.7 },
        M9: { benar: 0.3, salah: 0.7 }
      },
      posterior: {}
    };
  }

  return BN;
}

function updateBN(node, benar) {
  let BN = initBN();

  const prior   = BN.prior[node];
  const like    = benar ? BN.likelihood[node].benar : BN.likelihood[node].salah;
  const likeNot = 1 - like;

  const num = prior * like;
  const den = num + (1 - prior) * likeNot;
  const posterior = den === 0 ? prior : num / den;

  BN.prior[node]     = Number(posterior.toFixed(4));
  BN.posterior[node] = BN.prior[node];

   sessionStorage.setItem("BN_Data", JSON.stringify(BN));
}

/* ====== CEK JAWABAN ====== */
function cekJawaban() {
  const pilihan = document.querySelector('input[name="jawaban"]:checked');
  const feedback = document.getElementById("feedback");
  const nextBox = document.getElementById("nextBox");

  if (!pilihan) {
    feedback.className = "mt-6 p-4 rounded-xl border bg-yellow-100 text-yellow-800";
    feedback.classList.remove('hidden');
    feedback.innerHTML = "‚ùó Silakan pilih jawaban terlebih dahulu.";
    return;
  }

  const answer = pilihan.value;
  const benar = (answer === kunciJawaban);

  if (benar) {
    feedback.className = "mt-6 p-4 rounded-xl border bg-green-100 text-green-800";
    feedback.classList.remove('hidden');
    feedback.innerHTML =
      "üß† Jawaban Benar!<br>" +
      "- Titik potong: P1(4,8), P2(3,7), P3(10/3,20/3).<br>" +
      "- Luas segitiga P = 1/3 satuan luas (bisa dihitung dengan rumus shoelace/ determinan).<br>" +
      "- (9 √ó 1/3) + 3 fungsi = 3 + 3 = <b>6</b>.";
  } else {
    feedback.className = "mt-6 p-4 rounded-xl border bg-red-100 text-red-800";
    feedback.classList.remove('hidden');
    feedback.innerHTML =
      "‚ùå Jawaban kurang tepat.<br>" +
      "Periksa lagi:<br>" +
      "1. Tentukan tiga titik potong dengan sistem persamaan dua garis.<br>" +
      "2. Hitung luas segitiga dengan rumus shoelace/determinan (harus 1/3).<br>" +
      "3. Kalikan 9 √ó luas, lalu tambahkan jumlah fungsi (3).<br>" +
      "Miskonsepsi: <i>" +
      (miskonsepsiMap[answer] || "Kesalahan dalam menghitung luas segitiga atau menjumlahkan 9√óluas dengan jumlah fungsi.") +
      "</i>";
  }

  // >>> TAMPILKAN TOMBOL DULU, APAPUN HASILNYA
  if (nextBox) {
    nextBox.classList.remove("hidden");
  }

  // kunci semua opsi
  document.querySelectorAll('input[name="jawaban"]').forEach(r => r.disabled = true);

  // simpan rekap level 2
  simpanJawabanLevel2({
    soalId: "Nomor10",
    benar,
    jawaban: answer,
    kunci: kunciJawaban
  });

  // update BN ‚Üí Level 2 Soal 10 kita mapping ke M8
  updateBN("M8", benar);

  // tampilkan tombol rekap
  nextBox.classList.remove("hidden");
}

/* ====== NAVIGASI KE REKAP LEVEL 2 ====== */
function keHasilLevel2() {
  // pastikan file bernama tepat "hasillevel2.html" di folder yang sama
  window.location.href = "hasillevel2.html";
}
</script>

</body>
</html>